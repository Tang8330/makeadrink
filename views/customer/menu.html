{{#if owner}}
<h2>Drink Menu</h2>
<div>
    {{#each items}}
    <div class="col-xs-4" style="border: 1px solid #F0F0F0; border-radius: 15px; padding:5px; height:400px;">
        <div class="col-xs-12 text-center" style="border: 1px solid #5C9DFF; border-radius: 15px; padding:5px; height:250px;">
            {{#if pictures}}<img class="img img-responsive img-rounded" src="/item/picture/{{_id}}"></img>
            {{else}}<img class="img img-responsive img-rounded" src="/img/bev2.jpg"></img>
            {{/if}}
        </div>
        <div class="col-xs-12">
            <table>
                <tr style="height:20%;">
                    <td><strong>Drink name:&nbsp;</td>
							<td>{{name}}</strong></td>
                </tr>
                <tr style="height:20%;">
                    <td colspan="2">${{price}}</td>
                </tr>
                <tr style="height:20%;">
                    <td colspan="2">{{desc}}</td>
                </tr>
                <tr style="height:20%;">
                    <td colspan="2">&nbsp;
                    </td>
                </tr>
                <tr style="height:20%;">
                    <td colspan="2"><a class="btn btn-default" href="/item/edit/{{id}}" role="button">Edit</a>
                        <button type="button" class="btn btn-md" data-toggle="modal" id="delete" data-target="#deleteItem" onclick="passDelete('{{_id}}')">Delete</button>
                    </td>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    {{/each}}
    <div class="modal fade" id="deleteItem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form name="deleteItem" action="/item/delete" method="get">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title"><b>Delete Item</b></h4>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning" role="alert">
                            <span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>
                            <span class="sr-only">Warning:</span> This action will permanently delete this item. Would you like to continue?
                            <input type="text" style="display:none" name="id" id="deleteID" value="">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Delete</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-xs-12 text-right">
        <a class="btn btn-default" href="/item/add" role="button">Create</a>
    </div>
    {{else}}
    <div class="bckgrnd">
        <div class="row">
            <div class="col-md-12">
                <div class="text-right">
                    <button type="button" class="btn btn-md" data-toggle="modal" id="menu" data-target="#viewOrder" style="padding-right: 10px">View Order</button>
                    <a role="button" class="btn btn-success" href="/order/bill">Checkout</a>
                </div>
                <div class="modal fade" id="viewOrder" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form name="viewCustomerOrder" action="/order/add" method="post">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title"><b>Your Order</b></h4>
                                </div>
                                <div class="modal-body" id="cart">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Place</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <h2>Drink Menu</h2>
        </div>
        <div class="col-xs-12" style="background-color:#000000; height:3px;">
            &nbsp;
        </div>
        <div>
            {{#each items}}
            <div class="col-xs-4" style="border: 1px solid #F0F0F0; border-radius: 15px; padding:5px; height:400px;">
                <div class="col-xs-12 text-center" style="border: 1px solid #5C9DFF; border-radius: 15px; padding:5px; height:250px;">
                    {{#if pictures}}
                    <img class="img img-responsive img-rounded" src="/item/picture/{{_id}}"></img>
                    {{else}}
                    <img class="img img-responsive img-rounded" src="/img/bev2.jpg"></img>
                    {{/if}}
                </div>
                <div class="col-xs-12">
                    <table>
                        <tr style="height:20%;">
                            <td><strong>Drink name:&nbsp;</td>
							<td>{{name}}</strong></td>
                        </tr>
                        <tr style="height:20%;">
                            <td colspan="2">${{price}}</td>
                        </tr>
                        <tr style="height:20%;">
                            <td colspan="2">{{desc}}</td>
                        </tr>
                        <tr style="height:20%;">
                            <td colspan="2">&nbsp;
                            </td>
                        </tr>
                        <tr style="height:20%;">
                            <td colspan="2">
                                <button type="button" class="btn btn-md" data-toggle="modal" onclick="passView('{{name}}', '{{_id}}')" data-target="#addItem">Add</button>&nbsp;<a class="btn btn-default" href="/item/view/{{_id}}" role="button">More Info</a></td>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            {{/each}}
            <div class="modal fade" id="addItem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form name="addToOrder" method="post">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title"><b>Add Item</b></h4>
                            </div>
                            <div class="modal-body">
                                <div class="input-group">
                                    <span class="input-group-addon">Qty</span>
                                    <input type="number" class="form-control" value="1" step="1" name="quantity" />
                                </div>
                                <textarea type="text" name="request" placeholder="Special requests (e.g. no limes)" class="buff5 form-control"></textarea>
                                <input type="text" style="display:none" name="id" id="viewID" value="">
                                <input type="text" style="display:none" name="name" id="name" value="">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Add To Order</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            </table>
        </div>
    </div>
    {{/if}}
    <script src="/js/serializeObject.js"></script>
    <script src="/js/utility.js" type="text/javascript"></script>
    <script src="/js/jquery.cookie.js"></script>
    <script>
	$.cookie.json = true;

	function passView(name, id) {
		$('#viewID').val(id);
	    $('#name').val(name);
	}

	function passDelete(id) {
		$('#deleteID').val(id);
	}
    $('#menu').on('click', function(e) {
        var item = $.cookie("cart") || [];
        var text = "<table class='table table-hover'> <thead> <tr> <td> Name </td> <td> Quantity </td> <td> Request </td> </tr> </thead>";
        var name, quantity, specReq;
        for (var i = 0; i < item.length; i++) {
            name = JSON.stringify(item[i]['name']);
            quantity = JSON.stringify(item[i].quantity);
            specReq = JSON.stringify(item[i].request);
            text += "<tr> <td>" + name.substring(1, name.length - 1) + "</td> <td>" + quantity.substring(1, quantity.length - 1) + "</td> <td>" + specReq.substring(1, specReq.length - 1) + "</td> </tr>";
        }
        text += "</table>";
        if (item.length === 0) {
            text = "<i>There's nothing in your order!</i>";
        }
        $('#cart').html(text);
    });

    $('form[name=addToOrder]').submit(function(e) {
        var _this = this;
        e.preventDefault();
        var data = $(_this).serializeObject();
        var items = $.cookie("cart") || [];
        items.push(data);

        if ($.cookie("cart")) {
            $.cookie("cart", items, {
                path: "/"
            });
        } else {
            $.cookie("cart", items, {
                path: "/"
            });
        }
        $("#addItem").modal("hide");
    });

    $('form[name=viewCustomerOrder]').submit(function(e) {
        var _this = this;
        e.preventDefault();
        $.ajax({
            url: _this.action,
            type: _this.method,
            success: function(response) {
                $("#viewOrder").modal("hide");
            }
        });
    });

    $('form[name=deleteItem]').submit(function(e) {
        var _this = this;
        var id = $('#deleteID').val();
        $.ajax({
            url: _this.action + "/" + id,
            type: _this.method,
            success: function(response) {
                $("#deleteItem").modal("hide");
                location.reload();
            }
        });
    });
</script>